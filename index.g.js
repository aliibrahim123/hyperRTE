var N=Object.defineProperty;var a=(t,e)=>N(t,"name",{value:e,configurable:!0});var z=(t,e)=>{for(var r in e)N(t,r,{get:e[r],enumerable:!0})};var g=a((t,e)=>{if(typeof t!="string")throw new TypeError(`hyperRTE: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr"),f=a((t,e)=>{if(typeof t!="function")throw new TypeError(`hyperRTE: ${e} of type (${t?.constructor?.name}), expected (Function)`)},"checkfn"),E=a((t,e)=>{if(!Array.isArray(t))throw new TypeError(`hyperRTE: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr");var B=a((t,e)=>{if(!(t instanceof Node))throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (Node)`)},"checknode"),M=a((t,e)=>{if(typeof t!="string")throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr");var j=a((t,e)=>{if(!Array.isArray(t))throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr");var H=a(t=>(t.forEach((e,r)=>{if(!(e instanceof Node))throw new TypeError(`dom: element at index (${r}) of type (${e?.constructor?.name}), expected (Element)`)}),t),"checkEls"),W=/[a-z]/,G=a((t,e=document,r)=>{if(typeof t=="string"){if(t[0]?.match(W))return[b(t,e instanceof Node?[]:e,r)];if(t[0]==="<"){let o=document.createElement("div");return o.innerHTML=t,Array.from(o.children)}return B(e,"root"),Array.from(e.querySelectorAll(t))}if(t instanceof Element)return[t];if(Array.isArray(t))return H(t);if(t?.length!==void 0)return H(Array.from(t));throw new TypeError(`dom: a of type (${t?.constructor?.name}), expected (String) or (Element) or (ArrayLike)}`)},"$el"),b=a((t,e={},r=[])=>{M(t,"tag"),j(r,"children");var o=document.createElement(t);for(let n in e){let i=e[n];if(n==="text")o.innerText=i;else if(n==="classList")o.classList=Array.isArray(i)?i.join(" "):i;else if(n==="style")Object.assign(o.style,i);else if(n==="attr")for(let c in i)o.setAttribute(c,i[c]);else if(n==="events")for(let c in i)o.addEventListener(c,i[c]);else o[n]=i}return o.append(...r),o},"create");var l=a((t,e=!1)=>{M(t,"string");var r=document.createElement("div");return r.innerHTML=t,!e&&r.children.length===1?r.children[0]:Array.from(r.children)},"construct"),O=G;var T=a((t,e)=>{if(typeof t!="string")throw new TypeError(`events: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr"),R=a((t,e)=>{if(typeof t!="function")throw new TypeError(`events: ${e} of type (${t?.constructor?.name}), expected (Function)`)},"checkfn"),J=a((t,e)=>{if(!Array.isArray(t))throw new TypeError(`events: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr"),L=class{static{a(this,"EventEmmiter")}constructor(e={},r={}){this.opts={addUndifined:!0,...e},this.events={};for(let o in r)this.add(o),J(r[o],"listners"),r[o].forEach(n=>this.on(o,n))}add(e){if(T(e,"name"),e in this.events)throw new ReferenceError(`events: adding defined event (${e})`);return this.events[e]=[],this}has(e){return T(e,"name"),e in this.events}on(e,r){if(typeof e=="object"){for(let o in e)this.on(o,e[o]);return this}if(T(e,"name"),R(r,"listner"),e in this.events)this.events[e].push(r);else if(this.opts.addUndifined)this.events[e]=[r];else throw new ReferenceError(`events: undefined event (${e})`);return this}off(e,r){if(T(e,"name"),R(r,"listner"),e in this.events)r?this.events[e].splice(this.events[e].indexOf(r),1):this.events[e]=[];else throw new ReferenceError(`events: undefined event (${e})`);return this}once(e,r){T(e,"name"),R(r,"listner");var o=a((...n)=>{r(...n),this.off(e,o)},"onceFn");return this.on(e,o)}trigger(e,...r){if(T(e,"name"),e in this.events)this.events[e].forEach(o=>o(...r));else throw new ReferenceError(`events: undefined event (${e})`);return this}};var I=a((t,e)=>{var r=t.mainEl=O(e)[0];if(!r)throw new Error(`HyperRTE: no element with selector (${e})`);r.classList.add("hrte");var o=t.toolbarEl=l('<div class="hrte-toolbar">');r.append(o);var n=t.contentEl=l('<div class="hrte-content">');r.append(n),n.contentEditable=!0,n.addEventListener("keyup",()=>t.trigger("stateChange")),n.addEventListener("mouseup",()=>t.trigger("stateChange")),n.addEventListener("input",i=>t.trigger("input",i)),n.addEventListener("cut",i=>t.trigger("cut",i)),n.addEventListener("copy",i=>t.trigger("copy",i)),n.addEventListener("paste",i=>t.trigger("paste",i))},"constructMainUI"),P=a((t,e)=>{var{buttons:r,toolbarEl:o}=t;e.forEach(n=>{if(n==="separator")return o.append(l("<span class='hrte-button-separator'>&nbsp;</span>"));var i=r[n];if(!i)throw new TypeError(`HyperRTE: undefined button (${n})`);var{title:c,creator:s,state:p,action:d}=i,h=l(`<button class='hrte-button' title='${c}'>`);s(h,t),d&&h.addEventListener("click",v=>{t.contentEl.focus(),t.doAction(n,d)}),p&&t.on("stateChange",()=>p(t,h)?h.classList.add("hrte-button-selected"):h.classList.remove("hrte-button-selected")),o.append(h)})},"constructToolbar");var K=Math.sqrt(screen.height**2+screen.width**2)/100;document.body.style.setProperty("--vd",K+"px");var S=a(t=>{e:if(t.children.length===1&&t.classList.contains("styled")){var e=t.children[0],r=t,o={};for(q(t,o);r.children.length===1&&r.childNodes.length===1&&e.tagName===r.tagName&&e.classList.contains("styled");)r=e,e=e.children[0],q(r,o);if(r===t)break e;Object.keys(o).forEach(n=>{r.classList.add("styled-"+n),r.style[n]=o[n]}),t.after(r),t.remove(),t=r}Array.from(t.children).forEach(n=>S(n))},"cleanStyles"),q=a((t,e)=>Array.from(t.classList).filter(r=>r.startsWith("styled-")).map(r=>{var o=r.slice(7);e[o]=t.style[o]}),"handleStyles");var D={};z(D,{addColor:()=>Y,addInput:()=>C,addInputs:()=>Z,addList:()=>V,addMenu:()=>ee,addNumber:()=>X,addPanel:()=>_,createDialog:()=>Q,createDropDown:()=>$,createMenu:()=>F});var $=a((t=!0)=>{var e=l("<span class='hrte-dropDown'>"),r=a(i=>{t&&!e.contains(i.target)&&n()},"clickListner"),o=a(()=>{e.classList.add("hrte-dropDown-open"),document.body.addEventListener("click",r)},"open"),n=a(()=>{document.body.removeEventListener("click",r),e.classList.remove("hrte-dropDown-open")},"close");return[e,o,n]},"createDropDown"),Q=a((t=!0)=>{var e=l("<span class='hrte-dialog'>"),r=a(i=>{t&&!e.contains(i.target)&&n()},"clickListner"),o=a(()=>{e.classList.add("hrte-dialog-open"),document.body.addEventListener("click",r)},"open"),n=a(()=>{document.body.removeEventListener("click",r),e.classList.remove("hrte-dialog-open")},"close");return[e,o,n]},"createDialog"),V=a((t,e,r)=>{var{title:o,icon:n,data:i,item:c,action:s,state:p}=r;E(i,"data"),g(n,"icon"),f(c,"item transformer"),f(s,"action"),t.addButton(e,{title:o,state:p,creator:d=>{var[h,v,k]=$();i.forEach((y,u)=>{u!==0&&h.append(l("<div class='hrte-list-separator'>"));var m=l("<div class='hrte-list-item'>");m.append(c(y)),m.addEventListener("click",()=>{k(),x(),t.doAction(e,()=>s(y,t))}),h.append(m)});var x;d.addEventListener("click",y=>{y.stopPropagation(),x=t.captureSelection(),v()}),t.toolbarEl.append(h),d.append(l(n))}})},"addList"),C=a((t,e,r)=>{var{title:o,icon:n,action:i,state:c,type:s,reset:p,...d}=r;g(n,"icon"),g(n,"type"),f(i,"action"),t.addButton(e,{title:o,state:c,creator:h=>{var[v,k,x]=$(),y;h.addEventListener("click",U=>{U.stopPropagation(),y=t.captureSelection(),k()});var u=l(s==="textarea"?"<textarea>":"<input>");s!=="textarea"&&(u.type=s),Object.assign(u,d);var m=l('<span class="hrte-button2">apply</span>');if(m.addEventListener("click",()=>{x(),y(),t.doAction(e,()=>i(u.value,t))}),p){var A=l('<span class="hrte-button2">remove</span>');A.addEventListener("click",()=>{x(),y(),t.doAction(e,()=>i("initial",t))})}else var A="";v.append(u,b("div",{},[m,A])),t.toolbarEl.append(v),h.append(l(n))}})},"addInput"),X=a((t,e,r)=>C(t,e,{type:"number",...r}),"addNumber"),Y=a((t,e,r)=>C(t,e,{type:"color",reset:!0,...r}),"addColor"),Z=a((t,e,r)=>{var{title:o,icon:n,action:i,state:c,inputs:s}=r;E(s,"inputs"),f(i,"action"),t.addButton(e,{title:o,state:c,creator:p=>{var[d,h,v]=$(),k;p.addEventListener("click",u=>{u.stopPropagation(),k=t.captureSelection(),h()});var x=s.map(u=>{var m=b("input");return Object.assign(m,u),m}),y=l('<span class="hrte-button2">apply</span>');y.addEventListener("click",()=>{v(),k(),t.doAction(e,()=>i(...x.map(u=>u.value),t))}),d.append(...x,b("div",{},[y])),t.toolbarEl.append(d),p.append(l(n))}})},"addInputs"),_=a((t,e,r)=>{var{title:o,icon:n,creator:i}=r;f(i,"creator");var c=a(()=>{s.style.display="none",t.toolbarEl.style.display="",t.contentEl.style.display="",t.trigger("showMain")},"back"),[s,p]=i(t,c);s.classList.add("hrte-panel"),s.style.display="none",t.mainEl.append(s),t.addButton(e,{title:o,creator:d=>{d.append(l(n)),d.addEventListener("click",()=>{s.style.display="",t.toolbarEl.style.display="none",t.contentEl.style.display="none",t.trigger("hideMain"),p(t)})}})},"addPanel"),F=a((t,e)=>{var[r,o,n]=$(),i,c=!0;for(let p in e){f(e[p],"menu item ("+p+")");let d=l(`<div class='hrte-list-item'>${p}`);d.addEventListener("click",()=>{i(),e[p](t),n()}),c||r.append(l("<div class='hrte-list-separator'>")),r.append(d),c=!1}var s=a(()=>{i=t.captureSelection(),o()},"open");return[r,s,n]},"createMenu"),ee=a((t,e,r)=>{var{title:o,state:n,icon:i,...c}=r;g(i,"icon"),t.addButton(e,{title:o,state:n,creator:s=>{var[p,d]=F(t,c);s.addEventListener("click",h=>{h.stopPropagation(),d()}),t.toolbarEl.append(p),s.append(l(i))}})},"addMenu");var w=class{static{a(this,"HyperRTE")}buttons={};events=new L;constructor(e){var{el:r,plugins:o,toolbar:n,icons:i,clean:c}={el:null,plugins:[],toolbar:[],icons:"./icons/",clean:{cleanAfterAction:!0,doNotMergeTags:["div","span","p","li","ul","ol","a","mark"],doNotCleanTags:["hr","br","img","video","iframe","td","tr","table","caption"],skipTags:["svg","math"]},...e},{cleanAfterAction:s,doNotCleanTags:p,doNotMergeTags:d,skipTags:h}=c;this.cleanAfterAction=s,g(i,"icons path"),this.icons=i,E(p,"doNotCleanTags"),this.doNotCleanTags=p,E(d,"doNotMergeTags"),this.doNotMergeTags=d,E(h,"skipTags"),this.skipTags=h,["stateChange","beforeAction","afterAction","input","cut","copy","paste","export","showMain","hideMain"].forEach(v=>this.events.add(v)),I(this,r),E(o,"plugins"),o.forEach(v=>{f(v,"plugin"),v(this,e)}),E(n,"toolbar"),n.length===0&&(n=Object.keys(this.buttons)),P(this,n)}on(e,r){this.events.on(e,r)}off(e,r){this.events.off(e,r)}once(e,r){this.events.once(e,r)}trigger(e,...r){this.events.trigger(e,this,...r)}doAction(e,r,o=!1){g(e,"action name"),f(r,"handler"),!(!o&&!this.contentEl.contains(document.activeElement))&&(this.trigger("beforeAction",e),r(this),this.cleanAfterAction&&this.clean(),this.trigger("afterAction",e),this.contentEl.focus(),this.trigger("stateChange"))}get content(){return this.contentEl.innerHTML}set content(e){this.contentEl.innerHTML=e}clean(){this.contentEl.childNodes.length!==0&&($edit.cleanDom(this.contentEl,this.doNotCleanTags,this.doNotMergeTags,this.skipTags),S(this.contentEl))}focus(){this.contentEl.focus()}export(){var e=this.contentEl.cloneNode(!0);return this.trigger("export",e),e.innerHTML}captureSelection(){var e=getSelection();if(!e.rangeCount)return()=>{};var r=e.getRangeAt(0).cloneRange();return()=>{e.removeAllRanges(),e.addRange(r)}}addButton(e,r){if(g(e,"button name"),!r)throw new TypeError(`HyperRTE: definition of type (${r}), expected (Object)`);var{title:o,icon:n,creator:i,state:c,action:s}=r;g(o,"title"),n&&(g(n,"icon"),i=a(p=>p.append(l(n)),"creator")),f(i,"creator"),c&&f(c,"state"),s&&f(s,"action"),this.buttons[e]={title:o,creator:i,state:c,action:s}}};globalThis.HyperRTE=w;Object.assign(w,D);var Be=w;export{Y as addColor,C as addInput,Z as addInputs,V as addList,ee as addMenu,X as addNumber,_ as addPanel,Q as createDialog,$ as createDropDown,F as createMenu,Be as default};
