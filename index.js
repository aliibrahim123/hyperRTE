var te=Object.defineProperty;var a=(e,t)=>te(e,"name",{value:t,configurable:!0});var x=a((e,t)=>{if(typeof e!="string")throw new TypeError(`hyperRTE: ${t} of type (${e?.constructor?.name}), expected (String)`)},"checkstr"),g=a((e,t)=>{if(typeof e!="function")throw new TypeError(`hyperRTE: ${t} of type (${e?.constructor?.name}), expected (Function)`)},"checkfn"),k=a((e,t)=>{if(!Array.isArray(e))throw new TypeError(`hyperRTE: ${t} of type (${e?.constructor?.name}), expected (Array)`)},"checkarr");var W=a((e,t)=>{if(!(e instanceof Node))throw new TypeError(`dom: ${t} of type (${e?.constructor?.name}), expected (Node)`)},"checknode"),S=a((e,t)=>{if(typeof e!="string")throw new TypeError(`dom: ${t} of type (${e?.constructor?.name}), expected (String)`)},"checkstr");var _=a((e,t)=>{if(!Array.isArray(e))throw new TypeError(`dom: ${t} of type (${e?.constructor?.name}), expected (Array)`)},"checkarr");var z=a(e=>(e.forEach((t,r)=>{if(!(t instanceof Node))throw new TypeError(`dom: element at index (${r}) of type (${t?.constructor?.name}), expected (Element)`)}),e),"checkEls"),re=/[a-z]/,ne=a((e,t=document,r)=>{if(typeof e=="string"){if(e[0]?.match(re))return[$(e,t instanceof Node?[]:t,r)];if(e[0]==="<"){let n=document.createElement("div");return n.innerHTML=e,Array.from(n.children)}return W(t,"root"),Array.from(t.querySelectorAll(e))}if(e instanceof Element)return[e];if(Array.isArray(e))return z(e);if(e?.length!==void 0)return z(Array.from(e));throw new TypeError(`dom: a of type (${e?.constructor?.name}), expected (String) or (Element) or (ArrayLike)}`)},"$el"),$=a((e,t={},r=[])=>{S(e,"tag"),_(r,"children");var n=document.createElement(e);for(let o in t){let i=t[o];if(o==="text")n.innerText=i;else if(o==="classList")n.classList=Array.isArray(i)?i.join(" "):i;else if(o==="style")Object.assign(n.style,i);else if(o==="attr")for(let s in i)n.setAttribute(s,i[s]);else if(o==="events")for(let s in i)n.addEventListener(s,i[s]);else n[o]=i}return n.append(...r),n},"create"),X=a((e,t=document)=>(S(e,"query"),W(t,"root"),Array.from(t.querySelectorAll(e))),"query"),u=a((e,t=!1)=>{S(e,"string");var r=document.createElement("div");return r.innerHTML=e,!t&&r.children.length===1?r.children[0]:Array.from(r.children)},"construct"),G=ne;var L=a((e,t)=>{if(typeof e!="string")throw new TypeError(`events: ${t} of type (${e?.constructor?.name}), expected (String)`)},"checkstr"),j=a((e,t)=>{if(typeof e!="function")throw new TypeError(`events: ${t} of type (${e?.constructor?.name}), expected (Function)`)},"checkfn"),oe=a((e,t)=>{if(!Array.isArray(e))throw new TypeError(`events: ${t} of type (${e?.constructor?.name}), expected (Array)`)},"checkarr"),R=class{static{a(this,"EventEmmiter")}constructor(t={},r={}){this.opts={addUndifined:!0,...t},this.events={};for(let n in r)this.add(n),oe(r[n],"listners"),r[n].forEach(o=>this.on(n,o))}add(t){if(L(t,"name"),t in this.events)throw new ReferenceError(`events: adding defined event (${t})`);return this.events[t]=[],this}has(t){return L(t,"name"),t in this.events}on(t,r){if(typeof t=="object"){for(let n in t)this.on(n,t[n]);return this}if(L(t,"name"),j(r,"listner"),t in this.events)this.events[t].push(r);else if(this.opts.addUndifined)this.events[t]=[r];else throw new ReferenceError(`events: undefined event (${t})`);return this}off(t,r){if(L(t,"name"),j(r,"listner"),t in this.events)r?this.events[t].splice(this.events[t].indexOf(r),1):this.events[t]=[];else throw new ReferenceError(`events: undefined event (${t})`);return this}once(t,r){L(t,"name"),j(r,"listner");var n=a((...o)=>{r(...o),this.off(t,n)},"onceFn");return this.on(t,n)}trigger(t,...r){if(L(t,"name"),t in this.events)this.events[t].forEach(n=>n(...r));else throw new ReferenceError(`events: undefined event (${t})`);return this}};var J=a((e,t)=>{var r=e.mainEl=G(t)[0];if(!r)throw new Error(`HyperRTE: no element with selector (${t})`);r.classList.add("hrte");var n=e.toolbarEl=u('<div class="hrte-toolbar">');r.append(n);var o=e.contentEl=u('<div class="hrte-content">');r.append(o),o.contentEditable=!0,o.addEventListener("keyup",()=>e.trigger("stateChange")),o.addEventListener("mouseup",()=>e.trigger("stateChange")),o.addEventListener("input",i=>e.trigger("input",i)),o.addEventListener("cut",i=>e.trigger("cut",i)),o.addEventListener("copy",i=>e.trigger("copy",i)),o.addEventListener("paste",i=>e.trigger("paste",i))},"constructMainUI"),K=a((e,t)=>{var{buttons:r,toolbarEl:n}=e;t.forEach(o=>{if(o==="separator")return n.append(u("<span class='hrte-button-separator'>&nbsp;</span>"));var i=r[o];if(!i)throw new TypeError(`HyperRTE: undefined button (${o})`);var{title:s,creator:c,state:l,action:p}=i,d=u(`<button class='hrte-button' title='${s||""}'>`);c(d,e),p&&d.addEventListener("click",f=>{e.contentEl.focus(),e.doAction(o,p)}),l&&e.on("stateChange",()=>l(e,d)?d.classList.add("hrte-button-selected"):d.classList.remove("hrte-button-selected")),n.append(d)})},"constructToolbar");var ie=Math.sqrt(screen.height**2+screen.width**2)/100;document.body.style.setProperty("--vd",ie+"px");var I=a(e=>{e:if(e.children.length===1&&e.classList.contains("styled")){var t=e.children[0],r=e,n={};for(Q(e,n);r.children.length===1&&r.childNodes.length===1&&t.tagName===r.tagName&&t.classList.contains("styled");)r=t,t=t.children[0],Q(r,n);if(r===e)break e;Object.keys(n).forEach(o=>{r.classList.add("styled-"+o),r.style[o]=n[o]}),e.after(r),e.remove(),e=r}Array.from(e.children).forEach(o=>I(o))},"cleanStyles"),Q=a((e,t)=>Array.from(e.classList).filter(r=>r.startsWith("styled-")).map(r=>{var n=r.slice(7);t[n]=e.style[n]}),"handleStyles");var T=a((e,t)=>{if(!(e instanceof Element))throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Element)`)},"checkel"),M=a((e,t)=>{if(!(e instanceof Node))throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Node)`)},"checknode"),m=a((e,t)=>{if(typeof e!="string")throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (String)`)},"checkstr"),B=a((e,t)=>{if(typeof e!="function")throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Function)`)},"checkfn"),D=a((e,t)=>{if(!Array.isArray(e))throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Array)`)},"checkarr");var b=a(e=>{T(e,"element"),e.after(...e.childNodes),e.remove()},"unwrap"),q=a(()=>{var e=getSelection();if(e.rangeCount){var t=e.getRangeAt(0),r=t.startContainer;for(r.nodeType!==r.ELEMENT_NODE&&(r=r.parentElement);!r.hasAttribute("contenteditable");){if(r===document.body)return;r=r.parentElement}return r}},"getContainer"),P=a((e,t,r)=>{T(e,"element"),t&&M(t,"offset element"),r&&T(r,"offset parent");var n=e.cloneNode(!1),o=Array.from(e.childNodes),i=!1;for(let s=0;s<o.length;s++){let c=o[s];(i||c===t)&&(i=!0,n.append(c))}return r?r.prepend(n):e.after(n),n},"splitEl"),C=a((e,t)=>{m(e,"tag"),t&&B(t,"function");var r=getSelection();if(r.rangeCount){var n=r.getRangeAt(0),o=q();if(o)for(var i=n.commonAncestorContainer;i!==o;){if(i.tagName===e.toUpperCase()&&(!t||t(i)))return i;i=i.parentElement}}},"getWrapped");var H=a((e,t,r=!0,n,o={})=>{T(e,"element"),m(t,"tag"),n&&B(n,"cleaner"),t=t.toLowerCase();var i=[...e.getElementsByTagName(t)];r&&e.tagName===t.toUpperCase()&&i.push(e),i=i.filter(s=>Array.from(s.classList).every(c=>c in N?N[c](s,o[c]):!0)),n&&(i=i.filter(n)),i.forEach(s=>b(s))},"clean"),U=a((e,t=[],r=[],n=[],o=new Set)=>{if(M(e,"node"),D(t,"doNotCleanTags"),e.nodeType===e.ELEMENT_NODE){var i=Array.from(e.childNodes),s=e.tagName.toLowerCase();if(n.includes(s))return;t.includes(s)||(e.childNodes.length===0?e.remove():r.includes(s)||(e.tagName===e.previousSibling?.tagName?(e.previousSibling.append(...i),e.remove()):o.has(s)&&!Array.from(e.classList).some(c=>c in N)&&(e.after(...i),e.remove()))),i.forEach(c=>U(c,t,r,n,new Set([...o,s])))}else e.nodeType===3&&(e.textContent===""?e.remove():e.previousSibling?.nodeType===e.TEXT_NODE&&(e.previousSibling.textContent+=e.textContent,e.remove()))},"cleanDom"),N={styled(e,t){if(!t)return!1;var[r,n]=t;return e.classList.contains(n+"-"+r)&&(e.classList.remove(n+"-"+r),e.style[r]=""),[...e.classList].reduce((o,i)=>i.startsWith(n)?o+1:o,0)===1}};var V={unwrap:b,getContainer:q,splitEl:P,getWrapped:C,clean:H,cleanDom:U,cleanMap:N,isWrappedWith(e,t){return!!C(e,t)},surround(e,t=!0,r,n){T(e,"wrapper");var o=getSelection();if(!o.rangeCount)return{success:!1};var i=o.getRangeAt(0);return e.append(...i.cloneContents().childNodes),i.deleteContents(),t&&H(e,e.tagName,!1,r,n),i.insertNode(e),{success:!0,type:"surround",node:e}},undo(e,t,r){var n=getSelection();if(!n.rangeCount)return{success:!1};var o=n.getRangeAt(0),i=o.cloneContents();o.deleteContents();var s=document.createElement("span");s.append(i),H(s,e,!1,t,r),o.insertNode(s);var c=C(e,t);if(!c){var w=s.childNodes[0],y=s.childNodes[s.childNodes.length-1];return b(s),o.setStartBefore(w),o.setEndAfter(y),{success:!0,type:"undo"}}for(var l=s,p=[l];l!==c;)l=l.parentElement,p.unshift(l);var d;p.forEach((h,v)=>{h!==c&&(d=P(h.parentElement,h.nextSibling,d))});var f=p.reduce((h,v,E)=>{if(E===p.length-1)return h;var A=v.cloneNode(!1);return h===c?h.after(A):h.append(A),A});f===c?c.after(s):f.append(s);var w=s.childNodes[0],y=s.childNodes[s.childNodes.length-1];return b(s),o.setStartBefore(w),o.setEndAfter(y),{success:!0,type:"undo"}},replace(e="",t="text",r=!1){m(t,"replace type");var n=getSelection();if(!n.rangeCount)return{success:!1};var o=n.getRangeAt(0);if(o.deleteContents(),t==="node")o.insertNode(e);else{m(e,"topaste");let i=document.createElement("span");if(t==="text")i.innerText=e;else if(t==="html")i.innerHTML=e;else throw new TypeError("edit: undefined replace type ("+t+")");o.insertNode(i),r&&r(i)}return{success:!0,type:"replace"}},applyCss(e,t,r="span",n="styled",o=!0,i){m(e,"property"),m(t,"value");var s=document.createElement(r);return s.classList.add(n),s.classList.add(n+"-"+e),s.style[e]=t,this.surround(s,o,i,{styled:[e,n]})},copy(){var e=getSelection();if(!e.rangeCount)return"";var t=e.getRangeAt(0),r=document.createElement("div");return r.append(t.cloneContents()),r.innerHTML},cut(){var e=getSelection();if(!e.rangeCount)return"";var t=e.getRangeAt(0),r=document.createElement("div");return r.append(t.extractContents()),r.innerHTML},delete(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0);return t.deleteContents(),{success:!0,type:"delete"}},insert(e,t="text",r=!1){m(t,"insert type");var n=getSelection();if(!n.rangeCount)return{success:!1};var o=n.getRangeAt(0);if(t==="node")o.insertNode(e);else{m(e,"toinsert");var i=document.createElement("span");if(t==="text")i.innerText=e;else if(t==="html")i.innerHTML=e;else throw new Error("edit: undefined insert type ("+t+")");o.insertNode(i),r&&r(i)}return{success:!0,type:"insert"}},toggle(e,t=0,r,n,o){var i;if(e?.nodeType?(i=e,e=e.tagName.toLowerCase()):i=document.createElement(e),t===0)return this.isWrappedWith(e)?this.undo(e,n,o):this.surround(i,r,n,o);if(t===1)return this.surround(i,r,n,o);if(t===2)return this.undo(e,n,o);throw new Error("edit: toggle type is ("+t+"), expected 0, 1, or 2")},removeFormat(e=["b","i","u","s","sup","sub","span","div"]){D(e,"tagNames");var t=getSelection();if(!t.rangeCount)return{success:!1};var r=t.getRangeAt(0),n=t.toString();return r.deleteContents(),r.insertNode(new Text(n)),e.forEach(o=>this.undo(o)),{success:!0,type:"remove-format"}},getSelectedElement(){var e=getSelection();if(e.rangeCount){var t=e.getRangeAt(0).commonAncestorContainer;return t.nodeType===3?t.parentNode:t}},selectParagraph(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0),r=C("p");return r?(t.selectNode(r),{success:!0,type:"select"}):this.selectAll()},selectAll(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0),r=this.getContainer();return t.setStartBefore(r.firstChild),t.setEndAfter(r.lastChild),{success:!0,type:"select"}},bold(e){return this.toggle("b",e)},underline(e){return this.toggle("u",e)},italic(e){return this.toggle("i",e)},strikeThrough(e){return this.toggle("s",e)},subscript(e){return this.toggle("sub",e)},superscript(e){return this.toggle("sup",e)},backColor(e){return this.applyCss("background-color",e||"")},fontColor(e){return this.applyCss("color",e||"")},fontName(e){return this.applyCss("font-family",e||"")},fontSize(e){return this.applyCss("font-size",e||"")},link(e,t=!1){m(e,"url");var r=document.createElement("a");return r.href=e,t&&this.isWrappedWith("a")?this.undo("a"):this.surround(r)},img(e){m(e,"url");var t=document.createElement("img");return t.src=e,this.insert(t,"node")},heading(e=1,t){return this.toggle("h"+e,t)},orderedList(){var e=this.surround(document.createElement("li")),t=document.createElement("ol");return e.node.before(t),t.append(e.node),e},unorderedList(){var e=this.surround(document.createElement("li")),t=document.createElement("ul");return e.node.before(t),t.append(e.node),e},block(e){return this.toggle("div",e)},inline(e){return this.toggle("span",e)},paragraph(){var e=C("p");return e?(b(e),{success:!0,type:"undo"}):this.surround(document.createElement("p"))},quote(e){return this.toggle("q",e)},indent(e){return this.selectParagraph(),this.applyCss("text-indent",e||"","div")},align(e){return this.selectParagraph(),this.applyCss("text-align",e||"","div")},direction(e){return this.applyCss("direction",e||"","div")},hr(){return this.insert(document.createElement("hr"),"node")}};globalThis.$edit=V;var Y=V;var O=a((e=!0)=>{var t=u("<span class='hrte-dropDown'>"),r=a(i=>{e&&!t.contains(i.target)&&o()},"clickListner"),n=a(()=>{t.classList.add("hrte-dropDown-open"),document.body.addEventListener("click",r)},"open"),o=a(()=>{document.body.removeEventListener("click",r),t.classList.remove("hrte-dropDown-open")},"close");return[t,n,o]},"createDropDown"),Pe=a((e=!0)=>{var t=u("<span class='hrte-dialog'>"),r=a(i=>{e&&!t.contains(i.target)&&o()},"clickListner"),n=a(()=>{t.classList.add("hrte-dialog-open"),document.body.addEventListener("click",r)},"open"),o=a(()=>{document.body.removeEventListener("click",r),t.classList.remove("hrte-dialog-open")},"close");return[t,n,o]},"createDialog"),Ue=a((e,t,r)=>{var{title:n,icon:o,data:i,item:s,action:c,state:l}=r;k(i,"data"),x(o,"icon"),g(s,"item transformer"),g(c,"action"),e.addButton(t,{title:n,state:l,creator:p=>{var[d,f,w]=O();i.forEach((h,v)=>{v!==0&&d.append(u("<div class='hrte-list-separator'>"));var E=u("<div class='hrte-list-item'>");E.append(s(h,e)),E.addEventListener("click",()=>{w(),y(),e.doAction(t,()=>c(h,e))}),d.append(E)});var y;p.addEventListener("click",h=>{h.stopPropagation(),y=e.captureSelection(),f()}),e.toolbarEl.append(d),p.append(u(o))}})},"addList"),Z=a((e,t,r)=>{var{title:n,icon:o,action:i,state:s,type:c,reset:l,...p}=r;x(o,"icon"),x(o,"type"),g(i,"action"),e.addButton(t,{title:n,state:s,creator:d=>{var[f,w,y]=O(),h;d.addEventListener("click",ee=>{ee.stopPropagation(),h=e.captureSelection(),w()});var v=u(c==="textarea"?"<textarea>":"<input>");c!=="textarea"&&(v.type=c),Object.assign(v,p);var E=u('<span class="hrte-button2">apply</span>');if(E.addEventListener("click",()=>{y(),h(),e.doAction(t,()=>i(v.value,e))}),l){var A=u('<span class="hrte-button2">remove</span>');A.addEventListener("click",()=>{y(),h(),e.doAction(t,()=>i("initial",e))})}else var A="";f.append(v,$("div",{},[E,A])),e.toolbarEl.append(f),d.append(u(o))}})},"addInput"),Fe=a((e,t,r)=>Z(e,t,{type:"number",...r}),"addNumber"),_e=a((e,t,r)=>Z(e,t,{type:"color",reset:!0,...r}),"addColor"),ze=a((e,t,r)=>{var{title:n,icon:o,action:i,state:s,inputs:c}=r;k(c,"inputs"),g(i,"action"),e.addButton(t,{title:n,state:s,creator:l=>{var[p,d,f]=O(),w;l.addEventListener("click",v=>{v.stopPropagation(),w=e.captureSelection(),d()});var y=c.map(v=>{var E=$("input");return Object.assign(E,v),E}),h=u('<span class="hrte-button2">apply</span>');h.addEventListener("click",()=>{f(),w(),e.doAction(t,()=>i(...y.map(v=>v.value),e))}),p.append(...y,$("div",{},[h])),e.toolbarEl.append(p),l.append(u(o))}})},"addInputs"),Xe=a((e,t,r)=>{var{title:n,icon:o,creator:i}=r;g(i,"creator");var s=a(()=>{c.style.display="none",e.toolbarEl.style.display="",e.contentEl.style.display="",e.trigger("showMain")},"back"),[c,l]=i(e,s);c.classList.add("hrte-panel"),c.style.display="none",e.mainEl.append(c),e.addButton(t,{title:n,creator:p=>{p.append(u(o)),p.addEventListener("click",()=>{c.style.display="",e.toolbarEl.style.display="none",e.contentEl.style.display="none",e.trigger("hideMain"),l(e)})}})},"addPanel"),se=a((e,t)=>{var[r,n,o]=O(),i,s=!0;for(let l in t){g(t[l],"menu item ("+l+")");let p=u(`<div class='hrte-list-item'>${l}`);p.addEventListener("click",()=>{i(),t[l](e),o()}),s||r.append(u("<div class='hrte-list-separator'>")),r.append(p),s=!1}var c=a(()=>{i=e.captureSelection(),n()},"open");return[r,c,o]},"createMenu"),Ge=a((e,t,r)=>{var{title:n,state:o,icon:i,...s}=r;x(i,"icon"),e.addButton(t,{title:n,state:o,creator:c=>{var[l,p]=se(e,s);c.addEventListener("click",d=>{d.stopPropagation(),p()}),e.toolbarEl.append(l),c.append(u(i))}})},"addMenu");var F=class{static{a(this,"HyperRTE")}buttons={};events=new R;constructor(t){var{el:r,plugins:n,toolbar:o,icons:i,clean:s}={el:null,plugins:[],toolbar:[],icons:"./icons/",clean:{cleanAfterAction:!0,doNotMergeTags:["div","span","p","li","ul","ol","a","mark"],doNotCleanTags:["hr","br","img","video","iframe","td","tr","table","caption"],skipTags:["svg","math"]},...t},{cleanAfterAction:c,doNotCleanTags:l,doNotMergeTags:p,skipTags:d}=s;this.cleanAfterAction=c,x(i,"icons path"),this.icons=i,k(l,"doNotCleanTags"),this.doNotCleanTags=l,k(p,"doNotMergeTags"),this.doNotMergeTags=p,k(d,"skipTags"),this.skipTags=d,["stateChange","beforeAction","afterAction","input","cut","copy","paste","export","showMain","hideMain"].forEach(f=>this.events.add(f)),J(this,r),k(n,"plugins"),n.forEach(f=>{g(f,"plugin"),f(this,t)}),k(o,"toolbar"),o.length===0&&(o=Object.keys(this.buttons)),K(this,o)}on(t,r){this.events.on(t,r)}off(t,r){this.events.off(t,r)}once(t,r){this.events.once(t,r)}trigger(t,...r){this.events.trigger(t,this,...r)}doAction(t,r,n=!1){x(t,"action name"),g(r,"handler"),!(!n&&!this.contentEl.contains(document.activeElement))&&(this.trigger("beforeAction",t),r(this),this.cleanAfterAction&&this.clean(),this.trigger("afterAction",t),this.contentEl.focus(),this.trigger("stateChange"))}get content(){return this.contentEl.innerHTML}set content(t){this.contentEl.innerHTML=t}clean(){this.contentEl.childNodes.length!==0&&(Y.cleanDom(this.contentEl,this.doNotCleanTags,this.doNotMergeTags,this.skipTags),I(this.contentEl))}focus(){this.contentEl.focus()}export(){var t=this.contentEl.cloneNode(!0);return X(".styled",t).forEach(r=>Array.from(r.classList).forEach(n=>n.startsWith("styled")&&r.classList.remove(n))),this.trigger("export",t),t.innerHTML}captureSelection(){var t=getSelection();if(!t.rangeCount)return()=>{};var r=t.getRangeAt(0).cloneRange();return()=>{t.removeAllRanges(),t.addRange(r)}}addButton(t,r){if(x(t,"button name"),!r)throw new TypeError(`HyperRTE: definition of type (${r}), expected (Object)`);var{title:n,icon:o,creator:i,state:s,action:c}=r;x(n,"title"),o&&(x(o,"icon"),i=a(l=>l.append(u(o)),"creator")),g(i,"creator"),s&&g(s,"state"),c&&g(c,"action"),this.buttons[t]={title:n,creator:i,state:s,action:c}}};export{_e as addColor,Z as addInput,ze as addInputs,Ue as addList,Ge as addMenu,Fe as addNumber,Xe as addPanel,Pe as createDialog,O as createDropDown,se as createMenu,F as default};
