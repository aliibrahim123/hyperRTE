var q=Object.defineProperty;var a=(t,e)=>q(t,"name",{value:e,configurable:!0});var g=a((t,e)=>{if(typeof t!="string")throw new TypeError(`hyperRTE: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr"),f=a((t,e)=>{if(typeof t!="function")throw new TypeError(`hyperRTE: ${e} of type (${t?.constructor?.name}), expected (Function)`)},"checkfn"),m=a((t,e)=>{if(!Array.isArray(t))throw new TypeError(`hyperRTE: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr");var C=a((t,e)=>{if(!(t instanceof Node))throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (Node)`)},"checknode"),A=a((t,e)=>{if(typeof t!="string")throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr");var D=a((t,e)=>{if(!Array.isArray(t))throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr");var N=a(t=>(t.forEach((e,r)=>{if(!(e instanceof Node))throw new TypeError(`dom: element at index (${r}) of type (${e?.constructor?.name}), expected (Element)`)}),t),"checkEls"),F=/[a-z]/,U=a((t,e=document,r)=>{if(typeof t=="string"){if(t[0]?.match(F))return[T(t,e instanceof Node?[]:e,r)];if(t[0]==="<"){let o=document.createElement("div");return o.innerHTML=t,Array.from(o.children)}return C(e,"root"),Array.from(e.querySelectorAll(t))}if(t instanceof Element)return[t];if(Array.isArray(t))return N(t);if(t?.length!==void 0)return N(Array.from(t));throw new TypeError(`dom: a of type (${t?.constructor?.name}), expected (String) or (Element) or (ArrayLike)}`)},"$el"),T=a((t,e={},r=[])=>{A(t,"tag"),D(r,"children");var o=document.createElement(t);for(let n in e){let i=e[n];if(n==="text")o.innerText=i;else if(n==="classList")o.classList=Array.isArray(i)?i.join(" "):i;else if(n==="style")Object.assign(o.style,i);else if(n==="attr")for(let c in i)o.setAttribute(c,i[c]);else if(n==="events")for(let c in i)o.addEventListener(c,i[c]);else o[n]=i}return o.append(...r),o},"create");var d=a((t,e=!1)=>{A(t,"string");var r=document.createElement("div");return r.innerHTML=t,!e&&r.children.length===1?r.children[0]:Array.from(r.children)},"construct"),B=U;var k=a((t,e)=>{if(typeof t!="string")throw new TypeError(`events: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr"),M=a((t,e)=>{if(typeof t!="function")throw new TypeError(`events: ${e} of type (${t?.constructor?.name}), expected (Function)`)},"checkfn"),z=a((t,e)=>{if(!Array.isArray(t))throw new TypeError(`events: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr"),$=class{static{a(this,"EventEmmiter")}constructor(e={},r={}){this.opts={addUndifined:!0,...e},this.events={};for(let o in r)this.add(o),z(r[o],"listners"),r[o].forEach(n=>this.on(o,n))}add(e){if(k(e,"name"),e in this.events)throw new ReferenceError(`events: adding defined event (${e})`);return this.events[e]=[],this}has(e){return k(e,"name"),e in this.events}on(e,r){if(typeof e=="object"){for(let o in e)this.on(o,e[o]);return this}if(k(e,"name"),M(r,"listner"),e in this.events)this.events[e].push(r);else if(this.opts.addUndifined)this.events[e]=[r];else throw new ReferenceError(`events: undefined event (${e})`);return this}off(e,r){if(k(e,"name"),M(r,"listner"),e in this.events)r?this.events[e].splice(this.events[e].indexOf(r),1):this.events[e]=[];else throw new ReferenceError(`events: undefined event (${e})`);return this}once(e,r){k(e,"name"),M(r,"listner");var o=a((...n)=>{r(...n),this.off(e,o)},"onceFn");return this.on(e,o)}trigger(e,...r){if(k(e,"name"),e in this.events)this.events[e].forEach(o=>o(...r));else throw new ReferenceError(`events: undefined event (${e})`);return this}};var j=a((t,e)=>{var r=t.mainEl=B(e)[0];if(!r)throw new Error(`HyperRTE: no element with selector (${e})`);r.classList.add("hrte");var o=t.toolbarEl=d('<div class="hrte-toolbar">');r.append(o);var n=t.contentEl=d('<div class="hrte-content">');r.append(n),n.contentEditable=!0,n.addEventListener("keyup",()=>t.trigger("stateChange")),n.addEventListener("mouseup",()=>t.trigger("stateChange")),n.addEventListener("input",i=>t.trigger("input",i)),n.addEventListener("cut",i=>t.trigger("cut",i)),n.addEventListener("copy",i=>t.trigger("copy",i)),n.addEventListener("paste",i=>t.trigger("paste",i))},"constructMainUI"),I=a((t,e)=>{var{buttons:r,toolbarEl:o}=t;e.forEach(n=>{if(n==="separator")return o.append(d("<span class='hrte-button-separator'>&nbsp;</span>"));var i=r[n];if(!i)throw new TypeError(`HyperRTE: undefined button (${n})`);var{title:c,creator:s,state:p,action:l}=i,h=d(`<button class='hrte-button' title='${c}'>`);s(h,t),l&&h.addEventListener("click",v=>{t.contentEl.focus(),t.doAction(n,l)}),p&&t.on("stateChange",()=>p(t,h)?h.classList.add("hrte-button-selected"):h.classList.remove("hrte-button-selected")),o.append(h)})},"constructToolbar");var W=Math.sqrt(screen.height**2+screen.width**2)/100;document.body.style.setProperty("--vd",W+"px");var R=a(t=>{e:if(t.children.length===1&&t.classList.contains("styled")){var e=t.children[0],r=t,o={};for(O(t,o);r.children.length===1&&r.childNodes.length===1&&e.tagName===r.tagName&&e.classList.contains("styled");)r=e,e=e.children[0],O(r,o);if(r===t)break e;Object.keys(o).forEach(n=>{r.classList.add("styled-"+n),r.style[n]=o[n]}),t.after(r),t.remove(),t=r}Array.from(t.children).forEach(n=>R(n))},"cleanStyles"),O=a((t,e)=>Array.from(t.classList).filter(r=>r.startsWith("styled-")).map(r=>{var o=r.slice(7);e[o]=t.style[o]}),"handleStyles");var b=a((t=!0)=>{var e=d("<span class='hrte-dropDown'>"),r=a(i=>{t&&!e.contains(i.target)&&n()},"clickListner"),o=a(()=>{e.classList.add("hrte-dropDown-open"),document.body.addEventListener("click",r)},"open"),n=a(()=>{document.body.removeEventListener("click",r),e.classList.remove("hrte-dropDown-open")},"close");return[e,o,n]},"createDropDown"),he=a((t=!0)=>{var e=d("<span class='hrte-dialog'>"),r=a(i=>{t&&!e.contains(i.target)&&n()},"clickListner"),o=a(()=>{e.classList.add("hrte-dialog-open"),document.body.addEventListener("click",r)},"open"),n=a(()=>{document.body.removeEventListener("click",r),e.classList.remove("hrte-dialog-open")},"close");return[e,o,n]},"createDialog"),fe=a((t,e,r)=>{var{title:o,icon:n,data:i,item:c,action:s,state:p}=r;m(i,"data"),g(n,"icon"),f(c,"item transformer"),f(s,"action"),t.addButton(e,{title:o,state:p,creator:l=>{var[h,v,x]=b();i.forEach((y,u)=>{u!==0&&h.append(d("<div class='hrte-list-separator'>"));var E=d("<div class='hrte-list-item'>");E.append(c(y)),E.addEventListener("click",()=>{x(),w(),t.doAction(e,()=>s(y,t))}),h.append(E)});var w;l.addEventListener("click",y=>{y.stopPropagation(),w=t.captureSelection(),v()}),t.toolbarEl.append(h),l.append(d(n))}})},"addList"),H=a((t,e,r)=>{var{title:o,icon:n,action:i,state:c,type:s,reset:p,...l}=r;g(n,"icon"),g(n,"type"),f(i,"action"),t.addButton(e,{title:o,state:c,creator:h=>{var[v,x,w]=b(),y;h.addEventListener("click",P=>{P.stopPropagation(),y=t.captureSelection(),x()});var u=d(s==="textarea"?"<textarea>":"<input>");s!=="textarea"&&(u.type=s),Object.assign(u,l);var E=d('<span class="hrte-button2">apply</span>');if(E.addEventListener("click",()=>{w(),y(),t.doAction(e,()=>i(u.value,t))}),p){var L=d('<span class="hrte-button2">remove</span>');L.addEventListener("click",()=>{w(),y(),t.doAction(e,()=>i("initial",t))})}else var L="";v.append(u,T("div",{},[E,L])),t.toolbarEl.append(v),h.append(d(n))}})},"addInput"),ve=a((t,e,r)=>H(t,e,{type:"number",...r}),"addNumber"),ue=a((t,e,r)=>H(t,e,{type:"color",reset:!0,...r}),"addColor"),ye=a((t,e,r)=>{var{title:o,icon:n,action:i,state:c,inputs:s}=r;m(s,"inputs"),f(i,"action"),t.addButton(e,{title:o,state:c,creator:p=>{var[l,h,v]=b(),x;p.addEventListener("click",u=>{u.stopPropagation(),x=t.captureSelection(),h()});var w=s.map(u=>{var E=T("input");return Object.assign(E,u),E}),y=d('<span class="hrte-button2">apply</span>');y.addEventListener("click",()=>{v(),x(),t.doAction(e,()=>i(...w.map(u=>u.value),t))}),l.append(...w,T("div",{},[y])),t.toolbarEl.append(l),p.append(d(n))}})},"addInputs"),ge=a((t,e,r)=>{var{title:o,icon:n,creator:i}=r;f(i,"creator");var c=a(()=>{s.style.display="none",t.toolbarEl.style.display="",t.contentEl.style.display="",t.trigger("showMain")},"back"),[s,p]=i(t,c);s.classList.add("hrte-panel"),s.style.display="none",t.mainEl.append(s),t.addButton(e,{title:o,creator:l=>{l.append(d(n)),l.addEventListener("click",()=>{s.style.display="",t.toolbarEl.style.display="none",t.contentEl.style.display="none",t.trigger("hideMain"),p(t)})}})},"addPanel"),G=a((t,e)=>{var[r,o,n]=b(),i,c=!0;for(let p in e){f(e[p],"menu item ("+p+")");let l=d(`<div class='hrte-list-item'>${p}`);l.addEventListener("click",()=>{i(),e[p](t),n()}),c||r.append(d("<div class='hrte-list-separator'>")),r.append(l),c=!1}var s=a(()=>{i=t.captureSelection(),o()},"open");return[r,s,n]},"createMenu"),Ee=a((t,e,r)=>{var{title:o,state:n,icon:i,...c}=r;g(i,"icon"),t.addButton(e,{title:o,state:n,creator:s=>{var[p,l]=G(t,c);s.addEventListener("click",h=>{h.stopPropagation(),l()}),t.toolbarEl.append(p),s.append(d(i))}})},"addMenu");var S=class{static{a(this,"HyperRTE")}buttons={};events=new $;constructor(e){var{el:r,plugins:o,toolbar:n,icons:i,clean:c}={el:null,plugins:[],toolbar:[],icons:"./icons/",clean:{cleanAfterAction:!0,doNotMergeTags:["div","span","p","li","ul","ol","a","mark"],doNotCleanTags:["hr","br","img","video","iframe","td","tr","table","caption"],skipTags:["svg","math"]},...e},{cleanAfterAction:s,doNotCleanTags:p,doNotMergeTags:l,skipTags:h}=c;this.cleanAfterAction=s,g(i,"icons path"),this.icons=i,m(p,"doNotCleanTags"),this.doNotCleanTags=p,m(l,"doNotMergeTags"),this.doNotMergeTags=l,m(h,"skipTags"),this.skipTags=h,["stateChange","beforeAction","afterAction","input","cut","copy","paste","export","showMain","hideMain"].forEach(v=>this.events.add(v)),j(this,r),m(o,"plugins"),o.forEach(v=>{f(v,"plugin"),v(this,e)}),m(n,"toolbar"),n.length===0&&(n=Object.keys(this.buttons)),I(this,n)}on(e,r){this.events.on(e,r)}off(e,r){this.events.off(e,r)}once(e,r){this.events.once(e,r)}trigger(e,...r){this.events.trigger(e,this,...r)}doAction(e,r,o=!1){g(e,"action name"),f(r,"handler"),!(!o&&!this.contentEl.contains(document.activeElement))&&(this.trigger("beforeAction",e),r(this),this.cleanAfterAction&&this.clean(),this.trigger("afterAction",e),this.contentEl.focus(),this.trigger("stateChange"))}get content(){return this.contentEl.innerHTML}set content(e){this.contentEl.innerHTML=e}clean(){this.contentEl.childNodes.length!==0&&($edit.cleanDom(this.contentEl,this.doNotCleanTags,this.doNotMergeTags,this.skipTags),R(this.contentEl))}focus(){this.contentEl.focus()}export(){var e=this.contentEl.cloneNode(!0);return this.trigger("export",e),e.innerHTML}captureSelection(){var e=getSelection();if(!e.rangeCount)return()=>{};var r=e.getRangeAt(0).cloneRange();return()=>{e.removeAllRanges(),e.addRange(r)}}addButton(e,r){if(g(e,"button name"),!r)throw new TypeError(`HyperRTE: definition of type (${r}), expected (Object)`);var{title:o,icon:n,creator:i,state:c,action:s}=r;g(o,"title"),n&&(g(n,"icon"),i=a(p=>p.append(d(n)),"creator")),f(i,"creator"),c&&f(c,"state"),s&&f(s,"action"),this.buttons[e]={title:o,creator:i,state:c,action:s}}};export{ue as addColor,H as addInput,ye as addInputs,fe as addList,Ee as addMenu,ve as addNumber,ge as addPanel,he as createDialog,b as createDropDown,G as createMenu,S as default};
